"use strict";(()=>{var e={};e.id=4338,e.ids=[4338],e.modules={8496:(e,a,t)=>{t.a(e,async(e,s)=>{try{t.r(a),t.d(a,{config:()=>h,default:()=>m,getServerSideProps:()=>p,getStaticPaths:()=>u,getStaticProps:()=>x,reportWebVitals:()=>g,routeModule:()=>v,unstable_getServerProps:()=>f,unstable_getServerSideProps:()=>w,unstable_getStaticParams:()=>y,unstable_getStaticPaths:()=>b,unstable_getStaticProps:()=>j});var r=t(7093),n=t(5244),l=t(1323),i=t(7645),d=t(6814),c=t(8357),o=e([d,c]);[d,c]=o.then?(await o)():o;let m=(0,l.l)(c,"default"),x=(0,l.l)(c,"getStaticProps"),u=(0,l.l)(c,"getStaticPaths"),p=(0,l.l)(c,"getServerSideProps"),h=(0,l.l)(c,"config"),g=(0,l.l)(c,"reportWebVitals"),j=(0,l.l)(c,"unstable_getStaticProps"),b=(0,l.l)(c,"unstable_getStaticPaths"),y=(0,l.l)(c,"unstable_getStaticParams"),f=(0,l.l)(c,"unstable_getServerProps"),w=(0,l.l)(c,"unstable_getServerSideProps"),v=new r.PagesRouteModule({definition:{kind:n.x.PAGES,page:"/admin/bon",pathname:"/admin/bon",bundlePath:"",filename:""},components:{App:d.default,Document:i.default},userland:c});s()}catch(e){s(e)}})},3546:(e,a,t)=>{t.d(a,{I:()=>l});var s=t(997),r=t(6689),n=t(9832);let l=(0,r.forwardRef)(({className:e,type:a,label:t,error:r,helperText:l,leftIcon:i,rightIcon:d,id:c,...o},m)=>{let x=c||`input-${Math.random().toString(36).substr(2,9)}`;return(0,s.jsxs)("div",{className:"w-full",children:[t&&s.jsx("label",{htmlFor:x,className:"form-label",children:t}),(0,s.jsxs)("div",{className:"relative",children:[i&&s.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:s.jsx("span",{className:"text-gray-400 text-sm",children:i})}),s.jsx("input",{type:a,id:x,className:(0,n.cn)("form-input-modern",i&&"pl-12",d&&"pr-12",r&&"border-red-400 focus:border-red-500 focus:ring-red-500 shadow-glow-rose","focus:shadow-glow transition-all duration-300",e),ref:m,...o}),d&&s.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:s.jsx("span",{className:"text-gray-400 text-sm",children:d})})]}),r&&s.jsx("p",{className:"form-error",children:r}),l&&!r&&s.jsx("p",{className:"text-sm text-gray-500 mt-1",children:l})]})});l.displayName="Input"},8484:(e,a,t)=>{},8357:(e,a,t)=>{t.a(e,async(e,s)=>{try{t.r(a),t.d(a,{default:()=>_});var r=t(997),n=t(6689),l=t(968),i=t.n(l),d=t(9314),c=t(1163),o=t(8484),m=t(9948),x=t(6250),u=t(9767),p=t(3546),h=t(4449),g=t(8105),j=t(3982),b=t(4163),y=t(8617),f=t(1140),w=t(2506),v=t(9005),N=t(9832),k=e([x,u]);[x,u]=k.then?(await k)():k;let _=()=>{let{user:e,isAuthenticated:a,isLoading:t}=(0,d.a)(),s=(0,c.useRouter)(),{addToast:l}=(0,m.p)(),[k,_]=(0,n.useState)([]),[S,P]=(0,n.useState)([]),[C,B]=(0,n.useState)(!0),[E,Z]=(0,n.useState)(""),[M,q]=(0,n.useState)("all"),[z,D]=(0,n.useState)(1),[T,A]=(0,n.useState)(1),[I,L]=(0,n.useState)(!1),[$,F]=(0,n.useState)(null),[K,O]=(0,n.useState)({karyawan_id:0,jumlah_bon:0,cicilan_per_bulan:0,keterangan:""}),[R,W]=(0,n.useState)({}),[G,J]=(0,n.useState)(null),[V,U]=(0,n.useState)([]),[H,X]=(0,n.useState)([]);(0,n.useEffect)(()=>{if(!t&&!a){s.push("/login");return}if(!t&&e?.role!=="admin"){s.push("/dasbor");return}a&&e?.role==="admin"&&(Q(),Y())},[a,t,e,s,z,E,M]);let Q=async()=>{try{B(!0);let e=await fetch(`/api/bon?page=${z}&search=${E}&status=${M}`),a=await e.json();a.success?(_(a.data),A(a.pagination?.last_page||1)):l({type:"error",title:"Error",message:a.message||"Gagal mengambil data bon"})}catch(e){l({type:"error",title:"Error",message:"Terjadi kesalahan saat mengambil data bon"})}finally{B(!1)}},Y=async()=>{try{let e=await o.karyawanApi.getKaryawan({limit:1e3});e.success&&e.data&&P(e.data.data)}catch(e){}},ee=async(e,a)=>{try{let t=`/api/bon/eligibility?karyawan_id=${e}${a?`&amount=${a}`:""}`,s=await fetch(t),r=await s.json();if(r.success)return J(r.data),r.data}catch(e){}return null},ea=async e=>{e.preventDefault(),W({}),U([]),X([]);try{let e={karyawan_id:K.karyawan_id,jumlah_bon:K.jumlah_bon,cicilan_per_bulan:K.cicilan_per_bulan,keterangan:K.keterangan},a=await fetch("/api/bon",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),t=await a.json();t.success?(l({type:"success",title:"Berhasil",message:"Bon berhasil diajukan"}),L(!1),el(),Q()):(t.errors&&W(t.errors),t.validationErrors&&U(t.validationErrors),t.validationWarnings&&X(t.validationWarnings),l({type:"error",title:"Error",message:t.message||"Gagal mengajukan bon"}))}catch(e){l({type:"error",title:"Error",message:"Terjadi kesalahan saat mengajukan bon"})}},et=async e=>{O({...K,karyawan_id:parseInt(e)||0}),e?await ee(e):J(null)},es=async e=>{O({...K,jumlah_bon:parseFloat(e)||0}),K.karyawan_id&&e&&await ee(K.karyawan_id.toString(),e)},er=async e=>{try{let a=await fetch(`/api/bon/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"approve"})}),t=await a.json();t.success?(l({type:"success",title:"Berhasil",message:"Bon berhasil disetujui"}),Q()):l({type:"error",title:"Error",message:t.message||"Gagal menyetujui bon"})}catch(e){l({type:"error",title:"Error",message:"Terjadi kesalahan saat menyetujui bon"})}},en=async e=>{try{let a=await fetch(`/api/bon/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"reject"})}),t=await a.json();t.success?(l({type:"success",title:"Berhasil",message:"Bon berhasil ditolak"}),Q()):l({type:"error",title:"Error",message:t.message||"Gagal menolak bon"})}catch(e){l({type:"error",title:"Error",message:"Terjadi kesalahan saat menolak bon"})}},el=()=>{O({karyawan_id:0,jumlah_bon:0,cicilan_per_bulan:0,keterangan:""}),W({}),F(null),J(null),U([]),X([])},ei=()=>{L(!1),el()},ed=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(e),ec=e=>{let a={pending:{bg:"bg-yellow-100",text:"text-yellow-800",label:"Pending"},approved:{bg:"bg-green-100",text:"text-green-800",label:"Disetujui"},rejected:{bg:"bg-red-100",text:"text-red-800",label:"Ditolak"},completed:{bg:"bg-blue-100",text:"text-blue-800",label:"Selesai"},cancelled:{bg:"bg-gray-100",text:"text-gray-800",label:"Dibatalkan"}},t=a[e]||a.pending;return r.jsx("span",{className:(0,N.cn)("inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",t.bg,t.text),children:t.label})};return t?r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):(0,r.jsxs)(x.Z,{children:[r.jsx(i(),{children:r.jsx("title",{children:"Manajemen Bon - AFMS"})}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[r.jsx(h.Z,{className:"h-8 w-8 text-blue-600"}),"Manajemen Bon"]}),r.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Kelola pengajuan dan persetujuan bon karyawan"})]}),(0,r.jsxs)(u.z,{onClick:()=>{el(),L(!0)},className:"mt-4 sm:mt-0",children:[r.jsx(g.Z,{className:"h-4 w-4 mr-2"}),"Ajukan Bon Baru"]})]}),r.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[r.jsx("div",{className:"flex-1",children:(0,r.jsxs)("div",{className:"relative",children:[r.jsx(j.Z,{className:"h-5 w-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),r.jsx(p.I,{type:"text",placeholder:"Cari nama karyawan...",value:E,onChange:e=>Z(e.target.value),className:"pl-10"})]})}),r.jsx("div",{className:"sm:w-48",children:(0,r.jsxs)("select",{value:M,onChange:e=>q(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[r.jsx("option",{value:"all",children:"Semua Status"}),r.jsx("option",{value:"pending",children:"Pending"}),r.jsx("option",{value:"approved",children:"Disetujui"}),r.jsx("option",{value:"rejected",children:"Ditolak"}),r.jsx("option",{value:"completed",children:"Selesai"})]})})]})}),(0,r.jsxs)("div",{className:"bg-white shadow-sm rounded-lg border border-gray-200 overflow-hidden",children:[r.jsx("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[r.jsx("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx(b.Z,{className:"h-4 w-4"}),"Karyawan"]})}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx(h.Z,{className:"h-4 w-4"}),"Jumlah Bon"]})}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx(h.Z,{className:"h-4 w-4"}),"Sisa Bon"]})}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx(y.Z,{className:"h-4 w-4"}),"Cicilan/Bulan"]})}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx(f.Z,{className:"h-4 w-4"}),"Tanggal Pengajuan"]})}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Aksi"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:C?r.jsx("tr",{children:r.jsx("td",{colSpan:7,className:"px-6 py-4 text-center",children:r.jsx("div",{className:"flex justify-center",children:r.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"})})})}):0===k.length?r.jsx("tr",{children:r.jsx("td",{colSpan:7,className:"px-6 py-4 text-center text-gray-500",children:"Tidak ada data bon"})}):k.map(e=>(0,r.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[r.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.karyawan?.nama||"N/A"}),r.jsx("div",{className:"text-sm text-gray-500",children:e.karyawan?.telepon||"N/A"})]}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:ed(e.jumlah_bon)}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:ed(e.sisa_bon)}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:ed(e.cicilan_per_bulan)}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(e.tanggal_pengajuan).toLocaleDateString("id-ID")}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:ec(e.status)}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:r.jsx("div",{className:"flex items-center gap-2",children:"pending"===e.status&&(0,r.jsxs)(r.Fragment,{children:[r.jsx(u.z,{size:"sm",variant:"success",onClick:()=>er(e.id),children:r.jsx(w.Z,{className:"h-4 w-4"})}),r.jsx(u.z,{size:"sm",variant:"destructive",onClick:()=>en(e.id),children:r.jsx(v.Z,{className:"h-4 w-4"})})]})})})]},e.id))})]})}),T>1&&(0,r.jsxs)("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6",children:[(0,r.jsxs)("div",{className:"flex-1 flex justify-between sm:hidden",children:[r.jsx(u.z,{variant:"outline",onClick:()=>D(Math.max(1,z-1)),disabled:1===z,children:"Previous"}),r.jsx(u.z,{variant:"outline",onClick:()=>D(Math.min(T,z+1)),disabled:z===T,children:"Next"})]}),(0,r.jsxs)("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[r.jsx("div",{children:(0,r.jsxs)("p",{className:"text-sm text-gray-700",children:["Halaman ",r.jsx("span",{className:"font-medium",children:z})," dari"," ",r.jsx("span",{className:"font-medium",children:T})]})}),r.jsx("div",{children:(0,r.jsxs)("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px",children:[r.jsx(u.z,{variant:"outline",onClick:()=>D(Math.max(1,z-1)),disabled:1===z,className:"rounded-r-none",children:"Previous"}),r.jsx(u.z,{variant:"outline",onClick:()=>D(Math.min(T,z+1)),disabled:z===T,className:"rounded-l-none",children:"Next"})]})})]})]})]})]}),I&&r.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:r.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,r.jsxs)("div",{className:"mt-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Ajukan Bon Baru"}),r.jsx("button",{onClick:ei,className:"text-gray-400 hover:text-gray-600",children:r.jsx(v.Z,{className:"h-6 w-6"})})]}),(0,r.jsxs)("form",{onSubmit:ea,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Karyawan *"}),(0,r.jsxs)("select",{value:K.karyawan_id,onChange:e=>et(e.target.value),className:(0,N.cn)("w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",R.karyawan_id?"border-red-500":"border-gray-300"),required:!0,children:[r.jsx("option",{value:"",children:"Pilih Karyawan"}),S.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.nama," - ",e.jabatan?.nama_jabatan]},e.id))]}),R.karyawan_id&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:R.karyawan_id})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Jumlah Bon *"}),r.jsx(p.I,{type:"number",value:K.jumlah_bon,onChange:e=>es(e.target.value),className:R.jumlah_bon?"border-red-500":"",placeholder:"Masukkan jumlah bon",required:!0}),R.jumlah_bon&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:R.jumlah_bon})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cicilan per Bulan *"}),r.jsx(p.I,{type:"number",value:K.cicilan_per_bulan,onChange:e=>O({...K,cicilan_per_bulan:parseFloat(e.target.value)||0}),className:R.cicilan_per_bulan?"border-red-500":"",placeholder:"Masukkan cicilan per bulan",required:!0}),R.cicilan_per_bulan&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:R.cicilan_per_bulan})]}),G&&(0,r.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-4",children:[r.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:"Informasi Kelayakan"}),(0,r.jsxs)("div",{className:"text-sm text-blue-800 space-y-1",children:[(0,r.jsxs)("p",{children:["Gaji Pokok: ",ed(G.gaji_pokok)]}),(0,r.jsxs)("p",{children:["Maksimal Bon: ",ed(G.max_bon_amount)]}),(0,r.jsxs)("p",{children:["Bon Aktif: ",ed(G.current_bon_amount)]}),(0,r.jsxs)("p",{children:["Sisa Limit: ",ed(G.remaining_limit)]}),(0,r.jsxs)("p",{className:`font-medium ${G.is_eligible?"text-green-600":"text-red-600"}`,children:["Status: ",G.is_eligible?"Layak":"Tidak Layak"]})]})]}),V.length>0&&(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:[r.jsx("h4",{className:"text-sm font-medium text-red-900 mb-2",children:"Error Validasi"}),r.jsx("ul",{className:"text-sm text-red-800 space-y-1",children:V.map((e,a)=>(0,r.jsxs)("li",{children:["• ",e]},a))})]}),H.length>0&&(0,r.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4",children:[r.jsx("h4",{className:"text-sm font-medium text-yellow-900 mb-2",children:"Peringatan"}),r.jsx("ul",{className:"text-sm text-yellow-800 space-y-1",children:H.map((e,a)=>(0,r.jsxs)("li",{children:["• ",e]},a))})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Keterangan"}),r.jsx("textarea",{value:K.keterangan,onChange:e=>O({...K,keterangan:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3,placeholder:"Masukkan keterangan (opsional)"})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[r.jsx(u.z,{type:"button",variant:"outline",onClick:ei,children:"Batal"}),r.jsx(u.z,{type:"submit",children:"Ajukan Bon"})]})]})]})})})]})};s()}catch(e){s(e)}})},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},968:e=>{e.exports=require("next/head")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},6162:e=>{e.exports=require("stream")},1568:e=>{e.exports=require("zlib")},9752:e=>{e.exports=import("@tanstack/react-query")},6926:e=>{e.exports=import("class-variance-authority")},2506:(e,a,t)=>{t.d(a,{Z:()=>r});var s=t(6689);let r=s.forwardRef(function({title:e,titleId:a,...t},r){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":a},t),e?s.createElement("title",{id:a},e):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m4.5 12.75 6 6 9-13.5"}))})},3982:(e,a,t)=>{t.d(a,{Z:()=>r});var s=t(6689);let r=s.forwardRef(function({title:e,titleId:a,...t},r){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":a},t),e?s.createElement("title",{id:a},e):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"}))})},8105:(e,a,t)=>{t.d(a,{Z:()=>r});var s=t(6689);let r=s.forwardRef(function({title:e,titleId:a,...t},r){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":a},t),e?s.createElement("title",{id:a},e):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))})}};var a=require("../../webpack-runtime.js");a.C(e);var t=e=>a(a.s=e),s=a.X(0,[6859,8342,7890,1557],()=>t(8496));module.exports=s})();