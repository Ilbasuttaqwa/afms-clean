"use strict";(()=>{var a={};a.id=2478,a.ids=[2478],a.modules={145:a=>{a.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(a,n)=>{Object.defineProperty(n,"l",{enumerable:!0,get:function(){return function a(n,e){return e in n?n[e]:"then"in n&&"function"==typeof n.then?n.then(n=>a(n,e)):"function"==typeof n&&"default"===e?n:void 0}}})},6681:(a,n,e)=>{e.r(n),e.d(n,{config:()=>c,default:()=>_,routeModule:()=>g});var t={};e.r(t),e.d(t,{default:()=>d});var i=e(1802),r=e(7153),s=e(6249);(function(){var a=Error("Cannot find module '../../../lib/auth-middleware'");throw a.code="MODULE_NOT_FOUND",a})(),function(){var a=Error("Cannot find module '../../../lib/bon-rules'");throw a.code="MODULE_NOT_FOUND",a}();let u=[{id:1,karyawan_id:1,jumlah_bon:5e6,sisa_bon:3e6,cicilan_per_bulan:5e5,tanggal_pengajuan:"2024-01-15",tanggal_persetujuan:"2024-01-16",status:"approved",keterangan:"Bon untuk keperluan mendesak",approved_by:1,created_at:"2024-01-15T00:00:00.000Z",updated_at:"2024-01-16T00:00:00.000Z",karyawan:{id:1,nama:"John Doe",telepon:"081234567890",alamat:"Jl. Contoh No. 123",tanggal_lahir:"1990-01-01",jenis_kelamin:"L",cabang_id:1,jabatan_id:1,tanggal_masuk:"2023-01-15",status:"aktif",fingerprint_id:"FP001",created_at:"2023-01-15T00:00:00.000Z",updated_at:"2023-01-15T00:00:00.000Z"}},{id:2,karyawan_id:2,jumlah_bon:3e6,sisa_bon:3e6,cicilan_per_bulan:3e5,tanggal_pengajuan:"2024-01-20",status:"pending",keterangan:"Bon untuk biaya pendidikan anak",created_at:"2024-01-20T00:00:00.000Z",updated_at:"2024-01-20T00:00:00.000Z",karyawan:{id:2,nama:"Jane Smith",telepon:"081234567891",alamat:"Jl. Contoh No. 124",tanggal_lahir:"1992-05-15",jenis_kelamin:"P",cabang_id:1,jabatan_id:2,tanggal_masuk:"2023-02-01",status:"aktif",fingerprint_id:"FP002",created_at:"2023-02-01T00:00:00.000Z",updated_at:"2023-02-01T00:00:00.000Z"}}],l=3;async function o(a,n){try{switch(a.method){case"GET":let{page:e=1,limit:t=10,search:i="",status:r,karyawan_id:s}=a.query,o=[...u];i&&(o=o.filter(a=>a.karyawan?.nama.toLowerCase().includes(i.toString().toLowerCase()))),r&&"all"!==r&&(o=o.filter(a=>a.status===r)),s&&(o=o.filter(a=>a.karyawan_id===parseInt(s.toString())));let d=parseInt(e.toString()),_=parseInt(t.toString()),c=(d-1)*_,g=c+_,p=o.slice(c,g);return n.status(200).json({success:!0,message:"Data bon berhasil diambil",data:p,pagination:{current_page:d,per_page:_,total:o.length,last_page:Math.ceil(o.length/_),from:c+1,to:Math.min(g,o.length)}});case"POST":let b=a.body;if(!b.karyawan_id||!b.jumlah_bon||!b.cicilan_per_bulan)return n.status(400).json({success:!1,message:"Data tidak lengkap",errors:{karyawan_id:b.karyawan_id?[]:["Karyawan harus dipilih"],jumlah_bon:b.jumlah_bon?[]:["Jumlah bon harus diisi"],cicilan_per_bulan:b.cicilan_per_bulan?[]:["Cicilan per bulan harus diisi"]}});if(b.jumlah_bon<=0||b.cicilan_per_bulan<=0)return n.status(400).json({success:!1,message:"Jumlah bon dan cicilan harus lebih dari 0"});let m={id:b.karyawan_id,gaji_pokok:5e6,tanggal_masuk:"2023-01-15",status:"active"},h=Math.ceil(b.jumlah_bon/b.cicilan_per_bulan),j=u.map(a=>({id:a.id,karyawan_id:a.karyawan_id,jumlah_bon:a.jumlah_bon,sisa_bon:a.sisa_bon,cicilan_per_bulan:a.cicilan_per_bulan,status:a.status,tanggal_pengajuan:a.tanggal_pengajuan,tanggal_persetujuan:a.tanggal_persetujuan})),k=Object(function(){var a=Error("Cannot find module '../../../lib/bon-rules'");throw a.code="MODULE_NOT_FOUND",a}())(m,b.jumlah_bon,h,j,Object(function(){var a=Error("Cannot find module '../../../lib/bon-rules'");throw a.code="MODULE_NOT_FOUND",a}()));if(!k.isValid)return n.status(400).json({success:!1,message:"Pengajuan bon tidak valid",errors:k.errors,warnings:k.warnings});let f={id:l++,karyawan_id:b.karyawan_id,jumlah_bon:b.jumlah_bon,sisa_bon:b.jumlah_bon,cicilan_per_bulan:b.cicilan_per_bulan,tanggal_pengajuan:new Date().toISOString().split("T")[0],status:"pending",keterangan:b.keterangan,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return u.push(f),n.status(201).json({success:!0,message:"Bon berhasil diajukan",data:f});default:return n.setHeader("Allow",["GET","POST"]),n.status(405).json({success:!1,message:`Method ${a.method} tidak diizinkan`})}}catch(a){return n.status(500).json({success:!1,message:"Terjadi kesalahan server"})}}let d=Object(function(){var a=Error("Cannot find module '../../../lib/auth-middleware'");throw a.code="MODULE_NOT_FOUND",a}())(o),_=(0,s.l)(t,"default"),c=(0,s.l)(t,"config"),g=new i.PagesAPIRouteModule({definition:{kind:r.x.PAGES_API,page:"/api/bon",pathname:"/api/bon",bundlePath:"",filename:""},userland:t})},7153:(a,n)=>{var e;Object.defineProperty(n,"x",{enumerable:!0,get:function(){return e}}),function(a){a.PAGES="PAGES",a.PAGES_API="PAGES_API",a.APP_PAGE="APP_PAGE",a.APP_ROUTE="APP_ROUTE"}(e||(e={}))},1802:(a,n,e)=>{a.exports=e(145)}};var n=require("../../webpack-api-runtime.js");n.C(a);var e=n(n.s=6681);module.exports=e})();