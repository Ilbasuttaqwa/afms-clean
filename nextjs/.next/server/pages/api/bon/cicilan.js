"use strict";(()=>{var e={};e.id=7140,e.ids=[7140],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,a)=>{Object.defineProperty(a,"l",{enumerable:!0,get:function(){return function e(a,t){return t in a?a[t]:"then"in a&&"function"==typeof a.then?a.then(a=>e(a,t)):"function"==typeof a&&"default"===t?a:void 0}}})},6969:(e,a,t)=>{t.r(a),t.d(a,{config:()=>_,default:()=>p,routeModule:()=>g});var n={};t.r(n),t.d(n,{default:()=>c});var i=t(1802),s=t(7153),r=t(6249);!function(){var e=Error("Cannot find module '../../../lib/auth-middleware'");throw e.code="MODULE_NOT_FOUND",e}();let d=[{id:1,karyawan_id:1,jumlah_bon:5e6,sisa_bon:3e6,cicilan_per_bulan:5e5,tanggal_pengajuan:"2024-01-15",tanggal_persetujuan:"2024-01-16",status:"approved",keterangan:"Bon untuk keperluan mendesak",approved_by:1,created_at:"2024-01-15T00:00:00.000Z",updated_at:"2024-01-16T00:00:00.000Z"},{id:2,karyawan_id:2,jumlah_bon:3e6,sisa_bon:3e6,cicilan_per_bulan:3e5,tanggal_pengajuan:"2024-01-20",tanggal_persetujuan:"2024-01-21",status:"approved",keterangan:"Bon untuk biaya pendidikan anak",approved_by:1,created_at:"2024-01-20T00:00:00.000Z",updated_at:"2024-01-21T00:00:00.000Z"}],o=[{id:1,bon_id:1,periode:"2024-01",jumlah_cicilan:5e5,tanggal_potong:"2024-01-31",status:"processed",created_at:"2024-01-31T00:00:00.000Z",updated_at:"2024-01-31T00:00:00.000Z"},{id:2,bon_id:1,periode:"2024-02",jumlah_cicilan:5e5,tanggal_potong:"2024-02-29",status:"processed",created_at:"2024-02-29T00:00:00.000Z",updated_at:"2024-02-29T00:00:00.000Z"}],u=3;async function l(e,a){try{switch(e.method){case"GET":let{periode:t,karyawan_id:n,bon_id:i}=e.query,s=[...o];if(t&&(s=s.filter(e=>e.periode===t)),i&&(s=s.filter(e=>e.bon_id===parseInt(i.toString()))),n){let e=d.filter(e=>e.karyawan_id===parseInt(n.toString())).map(e=>e.id);s=s.filter(a=>e.includes(a.bon_id))}let r=s.map(e=>({...e,bon:d.find(a=>a.id===e.bon_id)}));return a.status(200).json({success:!0,message:"Data cicilan bon berhasil diambil",data:r});case"POST":let{periode:l}=e.body;if(!l)return a.status(400).json({success:!1,message:"Periode harus diisi"});let c=[];for(let e of d.filter(e=>"approved"===e.status&&e.sisa_bon>0))if(!o.find(a=>a.bon_id===e.id&&a.periode===l)){let a=Math.min(e.cicilan_per_bulan,e.sisa_bon),t={id:u++,bon_id:e.id,periode:l,jumlah_cicilan:a,tanggal_potong:new Date().toISOString().split("T")[0],status:"processed",created_at:new Date().toISOString(),updated_at:new Date().toISOString()};o.push(t),c.push(t),e.sisa_bon-=a,e.sisa_bon<=0&&(e.status="completed"),e.updated_at=new Date().toISOString()}return a.status(201).json({success:!0,message:`Berhasil memproses ${c.length} cicilan bon untuk periode ${l}`,data:c});case"PUT":let{id:p}=e.query,{status:_}=e.body;if(!p)return a.status(400).json({success:!1,message:"ID cicilan harus diisi"});let g=o.findIndex(e=>e.id===parseInt(p.toString()));if(-1===g)return a.status(404).json({success:!1,message:"Cicilan tidak ditemukan"});if(_&&["pending","processed","cancelled"].includes(_)&&(o[g].status=_,o[g].updated_at=new Date().toISOString(),"cancelled"===_)){let e=d.find(e=>e.id===o[g].bon_id);e&&(e.sisa_bon+=o[g].jumlah_cicilan,e.status="approved",e.updated_at=new Date().toISOString())}return a.status(200).json({success:!0,message:"Status cicilan berhasil diperbarui",data:o[g]});default:return a.setHeader("Allow",["GET","POST","PUT"]),a.status(405).json({success:!1,message:`Method ${e.method} tidak diizinkan`})}}catch(e){return a.status(500).json({success:!1,message:"Terjadi kesalahan server"})}}let c=Object(function(){var e=Error("Cannot find module '../../../lib/auth-middleware'");throw e.code="MODULE_NOT_FOUND",e}())(l),p=(0,r.l)(n,"default"),_=(0,r.l)(n,"config"),g=new i.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/bon/cicilan",pathname:"/api/bon/cicilan",bundlePath:"",filename:""},userland:n})},7153:(e,a)=>{var t;Object.defineProperty(a,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(e,a,t)=>{e.exports=t(145)}};var a=require("../../../webpack-api-runtime.js");a.C(e);var t=a(a.s=6969);module.exports=t})();