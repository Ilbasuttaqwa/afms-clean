"use strict";(()=>{var a={};a.id=8284,a.ids=[8284],a.modules={145:a=>{a.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(a,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function a(t,e){return e in t?t[e]:"then"in t&&"function"==typeof t.then?t.then(t=>a(t,e)):"function"==typeof t&&"default"===e?t:void 0}}})},7589:(a,t,e)=>{e.r(t),e.d(t,{config:()=>_,default:()=>d,routeModule:()=>m});var r={};e.r(r),e.d(r,{default:()=>l});var n=e(1802),i=e(7153),s=e(6249);(function(){var a=Error("Cannot find module '../../../lib/auth-middleware'");throw a.code="MODULE_NOT_FOUND",a})(),function(){var a=Error("Cannot find module '../../../lib/prisma'");throw a.code="MODULE_NOT_FOUND",a}();let o={admin:{total_karyawan:150,total_cabang:5,total_hadir_hari_ini:142,total_terlambat_hari_ini:8,total_alpha_hari_ini:0,persentase_kehadiran:94.7},user:{total_hadir_hari_ini:1,total_terlambat_hari_ini:0,jam_masuk:"08:00",jam_keluar:"17:00",status_hari_ini:"Hadir"}};async function u(a,t){if("GET"!==a.method)return t.status(405).json({message:"Method not allowed"});try{let e=a.user?.role,r=new Date;r.setHours(0,0,0,0);let n=new Date(r);if(n.setDate(n.getDate()+1),"admin"===e||"manager"===e)try{let[a,e,i]=await Promise.all([Object(function(){var a=Error("Cannot find module '../../../lib/prisma'");throw a.code="MODULE_NOT_FOUND",a}()).user.count({where:{role:{not:"admin"}}}),Object(function(){var a=Error("Cannot find module '../../../lib/prisma'");throw a.code="MODULE_NOT_FOUND",a}()).cabang.count(),Object(function(){var a=Error("Cannot find module '../../../lib/prisma'");throw a.code="MODULE_NOT_FOUND",a}()).absensi.findMany({where:{tanggal:{gte:r,lt:n}},include:{user:{include:{jabatan:!0}}}})]),s=i.filter(a=>a.jam_masuk).length,o=i.filter(a=>{if(!a.jam_masuk||!a.user?.jabatan)return!1;let t=new Date(a.jam_masuk),e=new Date(a.user.jabatan.jam_masuk||"08:00");return t>e}).length;return t.status(200).json({success:!0,data:{total_karyawan:a,total_cabang:e,total_hadir_hari_ini:s,total_terlambat_hari_ini:o,total_alpha_hari_ini:a-s,persentase_kehadiran:a>0?Math.round(s/a*100):0}})}catch(a){return t.status(200).json({success:!0,data:o.admin})}else try{let e=a.user?.id;if(!e)return t.status(401).json({message:"User ID not found"});let i=await Object(function(){var a=Error("Cannot find module '../../../lib/prisma'");throw a.code="MODULE_NOT_FOUND",a}()).absensi.findFirst({where:{id_user:parseInt(e),tanggal:{gte:r,lt:n}},include:{user:{include:{jabatan:!0}}}}),s=i?.jam_masuk?"Hadir":"Belum Absen",o=i?.user?.jabatan?.jam_masuk||"08:00";return t.status(200).json({success:!0,data:{total_hadir_hari_ini:i?.jam_masuk?1:0,total_terlambat_hari_ini:0,jam_masuk:o,jam_keluar:"17:00",status_hari_ini:s}})}catch(a){return t.status(200).json({success:!0,data:o.user})}}catch(a){return t.status(500).json({message:"Terjadi kesalahan server"})}}let l=Object(function(){var a=Error("Cannot find module '../../../lib/auth-middleware'");throw a.code="MODULE_NOT_FOUND",a}())(u),d=(0,s.l)(r,"default"),_=(0,s.l)(r,"config"),m=new n.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/dasbor/stats",pathname:"/api/dasbor/stats",bundlePath:"",filename:""},userland:r})},7153:(a,t)=>{var e;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return e}}),function(a){a.PAGES="PAGES",a.PAGES_API="PAGES_API",a.APP_PAGE="APP_PAGE",a.APP_ROUTE="APP_ROUTE"}(e||(e={}))},1802:(a,t,e)=>{a.exports=e(145)}};var t=require("../../../webpack-api-runtime.js");t.C(a);var e=t(t.s=7589);module.exports=e})();