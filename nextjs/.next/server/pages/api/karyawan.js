"use strict";(()=>{var a={};a.id=514,a.ids=[514],a.modules={3524:a=>{a.exports=require("@prisma/client")},145:a=>{a.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(a,e)=>{Object.defineProperty(e,"l",{enumerable:!0,get:function(){return function a(e,t){return t in e?e[t]:"then"in e&&"function"==typeof e.then?e.then(e=>a(e,t)):"function"==typeof e&&"default"===t?e:void 0}}})},5214:(a,e,t)=>{t.r(e),t.d(e,{config:()=>g,default:()=>l,routeModule:()=>p});var n={};t.r(n),t.d(n,{default:()=>c});var r=t(1802),i=t(7153),s=t(6249),d=t(3524);!function(){var a=Error("Cannot find module '../../../lib/auth-middleware'");throw a.code="MODULE_NOT_FOUND",a}();let u=new d.PrismaClient;async function o(a,e){try{switch(a.method){case"GET":let{page:t=1,limit:n=10,search:r="",cabang_id:i,jabatan_id:s}=a.query,d=parseInt(t.toString()),o=parseInt(n.toString()),c=(d-1)*o,l={};r&&(l.OR=[{nama:{contains:r.toString(),mode:"insensitive"}},{email:{contains:r.toString(),mode:"insensitive"}}]),i&&(l.cabang_id=parseInt(i.toString())),s&&(l.jabatan_id=parseInt(s.toString()));let g=await u.user.count({where:l}),p=await u.user.findMany({where:l,include:{jabatan:{select:{id:!0,nama_jabatan:!0}},cabang:{select:{id:!0,nama_cabang:!0}}},orderBy:{created_at:"desc"},skip:c,take:o});return e.status(200).json({success:!0,data:p,pagination:{current_page:d,per_page:o,total:g,total_pages:Math.ceil(g/o)}});case"POST":let{nama:f,jabatan_id:_,cabang_id:m,telepon:b,alamat:w,tanggal_masuk:P,finger_id:j,status:h}=a.body;if(!f||!_||!m)return e.status(400).json({message:"Required fields: nama, jabatan_id, cabang_id"});let v=await u.jabatan.findUnique({where:{id:parseInt(_)}}),y=await u.cabang.findUnique({where:{id:parseInt(m)}});if(!v||!y)return e.status(400).json({message:"Invalid jabatan_id or cabang_id"});let A=await u.user.create({data:{nama_pegawai:f,password:"defaultpassword123",id_jabatan:parseInt(_),id_cabang:parseInt(m),alamat:w||null,tanggal_masuk:P?new Date(P):new Date,device_user_id:j||null,status_pegawai:"aktif"===h},include:{jabatan:{select:{id:!0,nama_jabatan:!0}},cabang:{select:{id:!0,nama_cabang:!0}}}});return e.status(201).json({success:!0,message:"Karyawan created successfully",data:A});default:return e.status(405).json({message:"Method not allowed"})}}catch(a){return e.status(500).json({message:"Internal server error"})}finally{await u.$disconnect()}}let c=Object(function(){var a=Error("Cannot find module '../../../lib/auth-middleware'");throw a.code="MODULE_NOT_FOUND",a}())(o),l=(0,s.l)(n,"default"),g=(0,s.l)(n,"config"),p=new r.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/karyawan",pathname:"/api/karyawan",bundlePath:"",filename:""},userland:n})},7153:(a,e)=>{var t;Object.defineProperty(e,"x",{enumerable:!0,get:function(){return t}}),function(a){a.PAGES="PAGES",a.PAGES_API="PAGES_API",a.APP_PAGE="APP_PAGE",a.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(a,e,t)=>{a.exports=t(145)}};var e=require("../../webpack-api-runtime.js");e.C(a);var t=e(e.s=5214);module.exports=t})();